{# var map array from ElementmapController  #}
{% from _self import showElement %}

<div class="elementmap">
    <label>{{ 'References to this element'|t('_elementmap') }}</label>

    {% if element.canonicalId != element.id %}
        <div class="elementmap-info">
            {{ 'Showing relations to canonical element'|t('_elementmap') }}
        </div>
    {% endif %}

    <ul>
        {% for element in map.incoming %}
            {{ showElement(element, settings) }}
        {% endfor %}
        {% if map.incoming | length == 0 %}
            <li>{{ 'None'|t('_elementmap') }}</li>
        {% endif %}
    </ul>
</div>

<div class="elementmap">
    <label>{{ 'References from this element'|t('_elementmap') }}</label>
    <ul>
        {% for element in map.outgoing %}
            {{ showElement(element, settings) }}
        {% endfor %}
        {% if map.outgoing | length == 0 %}
            <li>{{ 'None'|t('_elementmap') }}</li>
        {% endif %}
    </ul>
</div>

{% if map.elementsNotShown %}
    <div class="elementmap-info">
        {{ map.elementsNotShown }} {{ 'more'|t }} {{ '{count,plural,=1{element} other{elements}} not shown due to limit'|t('_elementmap', {count: map.elementsNotShown}) }}
    </div>
{% endif %}


{% macro showElement(element, settings) %}
    <li>
        <div class="elementmap-item">
            {% if element.image is defined %}
                <div>
                    {% if element.kind == 'image' %}
                        {% if element.image %}
                            <img class="thumbnail" src="{{ element.image }}" height="36" width="36">
                        {% else %}
                            {{ svg('@appicons/image.svg') }}
                        {% endif %}
                    {% elseif element.kind == 'video' %}
                        {{ svg('@appicons/video.svg') }}
                    {% else %}
                        <a href="{{ element.fileUrl }}" target="_blank">
                            {{ svg('@appicons/download.svg') }}
                        </a>
                    {% endif %}
                </div>
            {% else %}
                {% if element.icon is defined %}
                    {% set icon = svg(element.icon) %}

                    <div class="icon icon-mask">{{ svg(element.icon)|attr({style: "fill: #{element.color ?? '#000000'};"}) }}</div>
                {% endif %}
            {% endif %}
            {% if element.canView  %}
                <a href="{{ element.url }}" data-id="{{ element.id }}" data-editable>
                    {{ element.title }}
                </a>
            {% else %}
                <div>
                    {% if settings.showUnpermitted == 'true' %}
                        {{ element.title }}
                    {% else %}
                        {{ 'No permission to view this element'|t('_elementmap') }}
                    {% endif %}
                </div>

            {% endif %}
        </div>
    </li>
{% endmacro %}
